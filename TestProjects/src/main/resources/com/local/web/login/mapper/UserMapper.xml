<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.local.web.login.mapper.UserMapper">
	<select id="getQueryTotalCnt" resultType="int">
		SELECT FOUND_ROWS()
	</select>

	<select id="selectUserList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		/* UserMapper.selectUserList */
		SELECT  SQL_CALC_FOUND_ROWS
				USER.*
		FROM
				(SELECT * FROM USER ORDER BY uIDX) AS USER
		LIMIT ${start}, ${end}
	</select>

	<insert id="signUpUser" parameterType="java.util.HashMap">
		/* UserMapper.signUpUser */
		INSERT INTO
		USER(uId, uNm, uPwd)
		VALUES( 
				 #{uId}
				, #{uNm}
				, #{uPwd}
			  )
	</insert>

	<select id="checkLoginUser" parameterType="java.util.HashMap" resultType="com.local.web.common.domain.SessionVo">
		/* UserMapper.checkLoginUser */
		SELECT *
		FROM USER
		WHERE 1=1 
		AND uId=#{uId}
		AND uPwd=#{uPwd}
	</select>

	<insert id="createloginHist" parameterType="hashMap">
		/* UserMapper.createloginHist */
		INSERT INTO
		USER_CNCT_LOG
		VALUES(
				  #{uId}
				, #{ip}
				, now()
			   )
	</insert>

	<select id="selectLoginHist" parameterType="hashMap" resultType="hashMap">
		/* UserMapper.selectLoginHist */
		SELECT  SQL_CALC_FOUND_ROWS
				LOG.*
		FROM 
				(SELECT * FROM USER_CNCT_LOG ORDER BY logDate DESC) AS LOG
		LIMIT ${start}, ${end}
	</select>

	<select id="srchUserListRetrieve" parameterType="hashMap" resultType="hashMap">
		/* UserMapper.srchUserListRetrieve */
		SELECT   uNm  AS uNm
			   , uId  AS uId
			   , uIdx AS uIdx
		FROM USER
		WHERE 1=1
		AND uNm LIKE CONCAT('%', #{srch_user_nm} ,'%')
	</select>

	<update id="updateUser" parameterType="hashMap">
		/* UserMapper.updateUser */
		UPDATE USER
		SET
		<if test="uNm != null and uNm != ''">
		  uNm = #{uNm}
		</if>
		<if test="uPwd != null and uPwd != ''">
		, uPwd = #{uPwd}
		</if> 
		<if test="uId != null and uId != ''">
		, uId = #{uId}
		</if>
		WHERE
			uIdx = #{uIdx}		
	</update>

	<delete id="deleteUser" parameterType="hashMap">
		/* UserMapper.deleteUser */
		DELETE FROM USER
		WHERE uIdx=#{uIdx}
	</delete>
	
	
</mapper>